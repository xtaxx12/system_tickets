<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title><%= title %></title>
	<script src="https://cdn.tailwindcss.com"></script>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
	<style>
		* { font-family: 'Inter', system-ui, -apple-system, sans-serif; }
		body { background: #F7F8FA; }
		.input-field { 
			transition: all 0.2s ease;
			border: 1.5px solid #E2E8F0;
		}
		.input-field:hover { 
			border-color: #CBD5E1;
		}
		.input-field:focus { 
			outline: none;
			border-color: #3B82F6;
			box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
		}
		.btn-primary {
			background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
			transition: all 0.2s ease;
		}
		.btn-primary:hover {
			transform: translateY(-1px);
			box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.3);
		}
		.badge {
			display: inline-flex;
			align-items: center;
			padding: 0.375rem 0.75rem;
			border-radius: 9999px;
			font-size: 0.75rem;
			font-weight: 600;
			text-transform: uppercase;
			letter-spacing: 0.025em;
		}
		.badge-pendiente { background: #FEF3C7; color: #92400E; }
		.badge-proceso { background: #DBEAFE; color: #1E40AF; }
		.badge-resuelto { background: #D1FAE5; color: #065F46; }
		.badge-cerrado { background: #F3F4F6; color: #374151; }
		.priority-badge {
			display: inline-flex;
			align-items: center;
			gap: 0.5rem;
			padding: 0.375rem 0.875rem;
			border-radius: 9999px;
			font-size: 0.8125rem;
			font-weight: 600;
		}
		.priority-baja { background: #D1FAE5; color: #065F46; }
		.priority-media { background: #FEF3C7; color: #92400E; }
		.priority-alta { background: #FEE2E2; color: #991B1B; }
		.priority-critica { background: #FEE2E2; color: #991B1B; animation: pulse-border 2s infinite; }
		@keyframes pulse-border {
			0%, 100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.4); }
			50% { box-shadow: 0 0 0 6px rgba(220, 38, 38, 0); }
		}
		.comment-card {
			transition: all 0.2s ease;
		}
		.comment-card:hover {
			transform: translateX(4px);
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
		}
		.info-row {
			display: flex;
			padding: 1rem 0;
			border-bottom: 1px solid #F3F4F6;
		}
		.info-row:last-child {
			border-bottom: none;
		}
		.info-label {
			min-width: 160px;
			font-weight: 600;
			color: #6B7280;
			font-size: 0.875rem;
		}
		.info-value {
			color: #1F2937;
			font-size: 0.9375rem;
		}
		.timeline-dot {
			width: 12px;
			height: 12px;
			border-radius: 50%;
			background: #3B82F6;
			border: 3px solid #DBEAFE;
		}
	</style>
</head>
<body>
	<!-- Header Minimalista -->
	<header class="bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm">
		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
			<div class="flex items-center justify-between h-16">
				<div class="flex items-center gap-3">
					<svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"></path>
					</svg>
					<div>
						<h1 class="text-xl font-semibold text-gray-900">Ticket <%= ticket.reference %></h1>
						<p class="text-xs text-gray-500">Detalles del ticket de soporte</p>
					</div>
				</div>
				<nav class="flex items-center gap-2">
					<a href="/" class="px-4 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-50 rounded-lg transition">
						Nuevo Ticket
					</a>
					<a href="/tickets" class="px-4 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-50 rounded-lg transition">
						Listado
					</a>
					<a href="/admin/login" class="px-4 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-50 rounded-lg transition">
						Admin
					</a>
				</nav>
			</div>
		</div>
	</header>

	<!-- Main Content -->
	<main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
		<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
			<!-- Columna Principal -->
			<div class="lg:col-span-2 space-y-6">
				<!-- Card de Información Principal -->
				<div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
					<!-- Header del Ticket -->
					<div class="bg-gradient-to-r from-blue-50 to-indigo-50 px-6 py-5 border-b border-gray-200">
						<div class="flex items-start justify-between">
							<div class="flex-1">
								<h2 class="text-xl font-bold text-gray-900 mb-2"><%= ticket.subject %></h2>
								<div class="flex items-center gap-3 flex-wrap">
									<% 
										let statusClass = 'badge-pendiente';
										if (ticket.status === 'En Proceso') statusClass = 'badge-proceso';
										if (ticket.status === 'Resuelto') statusClass = 'badge-resuelto';
										if (ticket.status === 'Cerrado') statusClass = 'badge-cerrado';
										
										let priorityClass = 'priority-baja';
										let priorityLabel = 'Baja';
										if (ticket.priority.includes('Media')) {
											priorityClass = 'priority-media';
											priorityLabel = 'Media';
										}
										if (ticket.priority.includes('Alta') && !ticket.priority.includes('Crítica')) {
											priorityClass = 'priority-alta';
											priorityLabel = 'Alta';
										}
										if (ticket.priority.includes('Crítica')) {
											priorityClass = 'priority-critica';
											priorityLabel = 'Crítica';
										}
									%>
									<span class="badge <%= statusClass %>"><%= ticket.status %></span>
									<span class="priority-badge <%= priorityClass %>">
										<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
											<path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0113 13a2.99 2.99 0 01-.879 2.121z" clip-rule="evenodd"></path>
										</svg>
										<%= priorityLabel %>
									</span>
								</div>
							</div>
						</div>
					</div>

					<!-- Descripción -->
					<div class="px-6 py-5 border-b border-gray-100">
						<h3 class="text-sm font-semibold text-gray-700 uppercase tracking-wide mb-3 flex items-center gap-2">
							<svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"></path>
							</svg>
							Descripción del Problema
						</h3>
						<p class="text-gray-700 whitespace-pre-line leading-relaxed"><%= ticket.description %></p>
					</div>

					<!-- Imagen Adjunta -->
					<% if (ticket.image_path) { %>
						<div class="px-6 py-5 border-b border-gray-100">
							<h3 class="text-sm font-semibold text-gray-700 uppercase tracking-wide mb-3 flex items-center gap-2">
								<svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
								</svg>
								Imagen Adjunta
							</h3>
							<div class="rounded-lg overflow-hidden border border-gray-200">
								<img class="w-full h-auto" src="<%= ticket.image_path %>" alt="Imagen adjunta del ticket" />
							</div>
						</div>
					<% } %>

					<!-- Detalles Adicionales -->
					<div class="px-6 py-5">
						<h3 class="text-sm font-semibold text-gray-700 uppercase tracking-wide mb-4 flex items-center gap-2">
							<svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
							</svg>
							Información Adicional
						</h3>
						<div class="space-y-0">
							<div class="info-row">
								<span class="info-label">Tipo de Soporte</span>
								<span class="info-value flex items-center gap-2">
									<svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
									</svg>
									<%= ticket.support_type %>
								</span>
							</div>
							<div class="info-row">
								<span class="info-label">AnyDesk Instalado</span>
								<span class="info-value">
									<% if (ticket.has_anydesk) { %>
										<span class="inline-flex items-center gap-1.5 text-green-700">
											<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
												<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
											</svg>
											Sí
										</span>
									<% } else { %>
										<span class="inline-flex items-center gap-1.5 text-gray-500">
											<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
												<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
											</svg>
											No
										</span>
									<% } %>
								</span>
							</div>
							<% if (ticket.has_anydesk && ticket.anydesk_code) { %>
								<div class="info-row">
									<span class="info-label">Código AnyDesk</span>
									<span class="info-value font-mono text-blue-600 font-semibold"><%= ticket.anydesk_code %></span>
								</div>
							<% } %>
							<div class="info-row">
								<span class="info-label">Fecha de Creación</span>
								<span class="info-value flex items-center gap-2">
									<svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
									</svg>
									<%= new Date(ticket.created_at).toLocaleDateString('es-ES', { 
										weekday: 'long',
										year: 'numeric', 
										month: 'long', 
										day: 'numeric',
										hour: '2-digit',
										minute: '2-digit'
									}) %>
								</span>
							</div>
						</div>
					</div>

					<!-- Botón de Editar -->
					<div class="px-6 py-5 bg-gray-50 border-t border-gray-200">
						<a href="/tickets/<%= ticket.reference %>/editar?token=<%= ticket.edit_token %>" class="btn-primary inline-flex items-center gap-2 px-6 py-3 rounded-lg text-white font-semibold shadow-lg">
							<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
							</svg>
							Editar Ticket
						</a>
					</div>
				</div>

				<!-- Sección de Conversación -->
				<div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
					<div class="bg-gradient-to-r from-purple-50 to-pink-50 px-6 py-5 border-b border-gray-200">
						<div class="flex items-center justify-between">
							<div class="flex items-center gap-3">
								<svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
								</svg>
								<div>
									<h2 class="text-xl font-bold text-gray-900">Conversación</h2>
									<p class="text-sm text-gray-600"><%= comments && comments.length > 0 ? comments.length : 'Sin' %> comentario<%= comments && comments.length !== 1 ? 's' : '' %></p>
								</div>
							</div>
						</div>
					</div>

					<div class="px-6 py-6">
						<!-- Lista de Comentarios -->
						<% if (comments && comments.length > 0) { %>
							<div class="space-y-4 mb-8">
								<% comments.forEach((comment, index) => { %>
									<div class="comment-card bg-gray-50 rounded-xl p-5 border-l-4 border-purple-400">
										<div class="flex items-start gap-4">
											<div class="flex-shrink-0">
												<div class="w-10 h-10 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full flex items-center justify-center text-white font-semibold">
													<%= comment.author_name.charAt(0).toUpperCase() %>
												</div>
											</div>
											<div class="flex-1 min-w-0">
												<div class="flex items-baseline justify-between mb-2">
													<h4 class="text-sm font-semibold text-gray-900"><%= comment.author_name %></h4>
													<time class="text-xs text-gray-500 flex items-center gap-1">
														<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
															<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
														</svg>
														<%= new Date(comment.created_at).toLocaleDateString('es-ES', { 
															month: 'short', 
															day: 'numeric',
															hour: '2-digit',
															minute: '2-digit'
														}) %>
													</time>
												</div>
												<p class="text-gray-700 whitespace-pre-line text-sm leading-relaxed"><%= comment.content %></p>
											</div>
										</div>
									</div>
								<% }) %>
							</div>
						<% } else { %>
							<div class="text-center py-8 mb-8">
								<svg class="mx-auto h-16 w-16 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
								</svg>
								<p class="mt-3 text-sm text-gray-500">No hay comentarios aún. Sé el primero en comentar.</p>
							</div>
						<% } %>

						<!-- Formulario para Nuevo Comentario -->
						<div class="border-t border-gray-200 pt-6">
							<h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
								<svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
								</svg>
								Agregar Comentario
							</h3>
							<form method="POST" action="/tickets/<%= ticket.reference %>/comments" class="space-y-4">
								<div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
									<div>
										<label class="block text-sm font-medium text-gray-700 mb-2">
											Tu nombre
											<span class="text-red-500 ml-1">*</span>
										</label>
										<input
											type="text"
											name="author_name"
											required
											maxlength="100"
											class="input-field w-full px-4 py-3 rounded-lg bg-white text-gray-900 placeholder-gray-400"
											placeholder="Ej: Juan Pérez"
										/>
									</div>
									<div>
										<label class="block text-sm font-medium text-gray-700 mb-2">
											Tu email
											<span class="text-gray-500 font-normal ml-1">(opcional)</span>
										</label>
										<input
											type="email"
											name="author_email"
											maxlength="100"
											class="input-field w-full px-4 py-3 rounded-lg bg-white text-gray-900 placeholder-gray-400"
											placeholder="tu@email.com"
										/>
									</div>
								</div>
								<div>
									<label class="block text-sm font-medium text-gray-700 mb-2">
										Comentario
										<span class="text-red-500 ml-1">*</span>
									</label>
									<textarea
										name="content"
										rows="4"
										required
										class="input-field w-full px-4 py-3 rounded-lg bg-white text-gray-900 placeholder-gray-400 resize-none"
										placeholder="Escribe tu comentario aquí..."
									></textarea>
								</div>
								<div class="flex items-center justify-end">
									<button type="submit" class="btn-primary px-6 py-3 rounded-lg text-white font-semibold shadow-lg flex items-center gap-2">
										<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
										</svg>
										Enviar Comentario
									</button>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>

			<!-- Sidebar Derecho -->
			<div class="lg:col-span-1 space-y-6">
				<!-- Card de Solicitante -->
				<div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
					<div class="bg-gradient-to-r from-green-50 to-emerald-50 px-5 py-4 border-b border-gray-200">
						<h3 class="text-sm font-semibold text-gray-900 uppercase tracking-wide flex items-center gap-2">
							<svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
							</svg>
							Solicitante
						</h3>
					</div>
					<div class="p-5">
						<div class="flex items-center gap-3 mb-4">
							<div class="w-14 h-14 bg-gradient-to-br from-green-400 to-emerald-600 rounded-full flex items-center justify-center text-white font-bold text-xl">
								<%= ticket.requester_name.charAt(0).toUpperCase() %>
							</div>
							<div>
								<p class="font-semibold text-gray-900 text-base"><%= ticket.requester_name %></p>
								<p class="text-sm text-gray-600"><%= ticket.department %></p>
							</div>
						</div>
						<% if (ticket.email) { %>
							<div class="mt-4 pt-4 border-t border-gray-100">
								<p class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-1">Email</p>
								<a href="mailto:<%= ticket.email %>" class="text-sm text-blue-600 hover:text-blue-700 flex items-center gap-1">
									<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
									</svg>
									<%= ticket.email %>
								</a>
							</div>
						<% } %>
					</div>
				</div>

				<!-- Card de Referencia -->
				<div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
					<div class="bg-gradient-to-r from-amber-50 to-yellow-50 px-5 py-4 border-b border-gray-200">
						<h3 class="text-sm font-semibold text-gray-900 uppercase tracking-wide flex items-center gap-2">
							<svg class="w-4 h-4 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"></path>
							</svg>
							Referencia
						</h3>
					</div>
					<div class="p-5">
						<div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
							<p class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-1">ID del Ticket</p>
							<p class="text-lg font-mono font-bold text-gray-900"><%= ticket.reference %></p>
						</div>
						<p class="mt-3 text-xs text-gray-500">Use esta referencia para consultas futuras</p>
					</div>
				</div>

				<!-- Card de Ayuda -->
				<div class="bg-gradient-to-br from-blue-50 to-indigo-100 rounded-2xl p-5 border border-blue-200">
					<div class="flex gap-3">
						<svg class="w-6 h-6 text-blue-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
						</svg>
						<div>
							<h4 class="text-sm font-semibold text-blue-900 mb-2">¿Necesitas ayuda?</h4>
							<p class="text-xs text-blue-800 leading-relaxed">
								Puedes agregar comentarios para proporcionar más información o hacer seguimiento al ticket.
							</p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</main>
</body>
</html>
</path>div></path></div>svg></div>div></span>