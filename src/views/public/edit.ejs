<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title><%= title %></title>
	<link rel="stylesheet" href="/public/styles.css" />
</head>
<body>
	<header>
		<h1>Editar Ticket <%= ticket.reference %></h1>
		<nav>
			<a href="/tickets/<%= ticket.reference %>">Volver al detalle</a>
		</nav>
	</header>
	<main>
		<form action="/tickets/<%= ticket.reference %>/editar?token=<%= ticket.edit_token %>" method="post" enctype="multipart/form-data" class="form">
			<div class="field">
				<label>Nombre del solicitante</label>
				<input type="text" name="requester_name" value="<%= ticket.requester_name %>" />
			</div>
			<div class="field">
				<label>Área/Departamento</label>
				<input type="text" name="department" value="<%= ticket.department %>" />
			</div>
			<div class="field">
				<label>Tipo de Soporte</label>
				<select name="support_type">
					<% SUPPORT_TYPES.forEach(t => { %>
						<option value="<%= t %>" <%= ticket.support_type===t ? 'selected' : '' %>><%= t %></option>
					<% }) %>
				</select>
			</div>
			<div class="field">
				<label>Prioridad</label>
				<select name="priority">
					<% PRIORITIES.forEach(p => { %>
						<option value="<%= p %>" <%= ticket.priority===p ? 'selected' : '' %>><%= p %></option>
					<% }) %>
				</select>
			</div>
			<div class="field">
				<label>Asunto</label>
				<input type="text" name="subject" value="<%= ticket.subject %>" maxlength="120" />
			</div>
			<div class="field">
				<label>Descripción Detallada</label>
				<textarea name="description" rows="6"><%= ticket.description %></textarea>
			</div>
			<div class="field">
				<label>Actualizar Imagen (opcional)</label>
				<input type="file" name="image" accept="image/*" />
				<% if (ticket.image_path) { %>
					<p>Actual: <img src="<%= ticket.image_path %>" style="max-width:200px;" /></p>
				<% } %>
			</div>
			<div class="field">
				<label>¿Tiene AnyDesk instalado?</label>
				<select name="has_anydesk" id="has_anydesk">
					<option value="no" <%= ticket.has_anydesk ? '' : 'selected' %>>No</option>
					<option value="yes" <%= ticket.has_anydesk ? 'selected' : '' %>>Sí</option>
				</select>
			</div>
			<div class="field" id="anydesk_code_field" style="display:none;">
				<label>Código AnyDesk</label>
				<input type="text" name="anydesk_code" value="<%= ticket.anydesk_code || '' %>" />
			</div>
			<div class="actions">
				<button type="submit">Guardar Cambios</button>
			</div>
		</form>
	</main>
	<script>
		function toggleAnydesk(){
			const sel = document.getElementById('has_anydesk');
			document.getElementById('anydesk_code_field').style.display = sel.value === 'yes' ? 'block' : 'none';
		}
		document.getElementById('has_anydesk').addEventListener('change', toggleAnydesk);
		toggleAnydesk();
	</script>
</body>
</html>
