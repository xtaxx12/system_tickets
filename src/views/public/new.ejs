<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title><%= title %></title>
	<link rel="stylesheet" href="/public/styles.css" />
</head>
<body>
	<header>
		<h1>Crear Ticket de Soporte</h1>
		<nav>
			<a href="/tickets">Ver Tickets</a>
			<a href="/admin/login">Admin</a>
		</nav>
	</header>
	<main>
		<form action="/tickets" method="post" enctype="multipart/form-data" class="form">
			<div class="field">
				<label>Nombre del solicitante *</label>
				<input type="text" name="requester_name" value="<%= data.requester_name || '' %>" required />
				<% if (errors.requester_name) { %><small class="error"><%= errors.requester_name %></small><% } %>
			</div>
			<div class="field">
				<label>Área/Departamento *</label>
				<input type="text" name="department" value="<%= data.department || '' %>" required />
				<% if (errors.department) { %><small class="error"><%= errors.department %></small><% } %>
			</div>
			<div class="field">
				<label>Tipo de Soporte *</label>
				<select name="support_type" required>
					<option value="">Seleccione...</option>
					<% SUPPORT_TYPES.forEach(t => { %>
						<option value="<%= t %>" <%= data.support_type === t ? 'selected' : '' %>><%= t %></option>
					<% }) %>
				</select>
				<% if (errors.support_type) { %><small class="error"><%= errors.support_type %></small><% } %>
			</div>
			<div class="field">
				<label>Prioridad *</label>
				<select name="priority" required>
					<option value="">Seleccione...</option>
					<% PRIORITIES.forEach(p => { %>
						<option value="<%= p %>" <%= data.priority === p ? 'selected' : '' %>><%= p %></option>
					<% }) %>
				</select>
				<% if (errors.priority) { %><small class="error"><%= errors.priority %></small><% } %>
			</div>
			<div class="field">
				<label>Asunto *</label>
				<input type="text" name="subject" value="<%= data.subject || '' %>" maxlength="120" required />
				<% if (errors.subject) { %><small class="error"><%= errors.subject %></small><% } %>
			</div>
			<div class="field">
				<label>Descripción Detallada *</label>
				<textarea name="description" rows="6" required><%= data.description || '' %></textarea>
				<% if (errors.description) { %><small class="error"><%= errors.description %></small><% } %>
			</div>
			<div class="field">
				<label>Subir Imagen (opcional)</label>
				<input type="file" name="image" accept="image/*" />
			</div>
			<div class="field">
				<label>¿Tiene AnyDesk instalado?</label>
				<select name="has_anydesk" id="has_anydesk">
					<option value="no" <%= (data.has_anydesk||'no')==='no' ? 'selected' : '' %>>No</option>
					<option value="yes" <%= data.has_anydesk==='yes' ? 'selected' : '' %>>Sí</option>
				</select>
			</div>
			<div class="field" id="anydesk_code_field" style="display:none;">
				<label>Código AnyDesk</label>
				<input type="text" name="anydesk_code" value="<%= data.anydesk_code || '' %>" />
				<% if (errors.anydesk_code) { %><small class="error"><%= errors.anydesk_code %></small><% } %>
			</div>
			<div class="field">
				<label>Correo para confirmación (opcional)</label>
				<input type="email" name="email" placeholder="tu@correo.com" value="<%= data.email || '' %>" />
			</div>
			<div class="actions">
				<button type="submit">Crear Ticket</button>
			</div>
		</form>
	</main>
	<script>
		function toggleAnydesk(){
			const sel = document.getElementById('has_anydesk');
			document.getElementById('anydesk_code_field').style.display = sel.value === 'yes' ? 'block' : 'none';
		}
		document.getElementById('has_anydesk').addEventListener('change', toggleAnydesk);
		toggleAnydesk();
	</script>
</body>
</html>
